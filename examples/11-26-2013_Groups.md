Comparing Factors between Groups
===============================================================================


```r
library(lavaan)
library(foreign)

data_intell_f <- read.spss("../data/Grnt_fem.sav", to.data.frame = TRUE)
data_intell_m <- read.spss("../data/Grnt_mal.sav", to.data.frame = TRUE)
data_intell_f$sex <- 0
data_intell_m$sex <- 1

d <- rbind(data_intell_f, data_intell_m)
d$sex <- factor(d$sex, levels = c(0, 1), labels = c("Women", "Men"))
```



Multigroup CFA (no mean structure)
-------------------------------------------------------------------------------

Two latent variables, different factor loadings for groups:


```r
m2 <- '
  Fspatial =~ visperc + cubes + lozenges
  Fverbal =~ paragrap + sentence + wordmean'
fit2 <- sem(m2, data = d, likelihood = "wishart", group = "sex")
summary(fit2, standardized = TRUE, fit.measures = TRUE, rsquare = TRUE)
```

```
## lavaan (0.5-15) converged normally after 122 iterations
## 
##   Number of observations per group         
##   Women                                             73
##   Men                                               72
## 
##   Estimator                                         ML
##   Minimum Function Test Statistic               16.480
##   Degrees of freedom                                16
##   P-value (Chi-square)                           0.420
## 
## Chi-square for each group:
## 
##   Women                                          7.853
##   Men                                            8.627
## 
## Model test baseline model:
## 
##   Minimum Function Test Statistic              337.557
##   Degrees of freedom                                30
##   P-value                                        0.000
## 
## User model versus baseline model:
## 
##   Comparative Fit Index (CFI)                    0.998
##   Tucker-Lewis Index (TLI)                       0.997
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -2570.027
##   Loglikelihood unrestricted model (H1)      -2561.672
## 
##   Number of free parameters                         38
##   Akaike (AIC)                                5216.053
##   Bayesian (BIC)                              5328.641
##   Sample-size adjusted Bayesian (BIC)         5208.403
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.020
##   90 Percent Confidence Interval          0.000  0.112
##   P-value RMSEA <= 0.05                          0.603
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.040
## 
## Parameter estimates:
## 
##   Information                                 Expected
##   Standard Errors                             Standard
## 
## Group 1 [Women]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.861    0.703
##     cubes             0.610    0.143    4.249    0.000    2.964    0.654
##     lozenges          1.198    0.272    4.405    0.000    5.824    0.736
##   Fverbal =~
##     paragrap          1.000                               3.133    0.880
##     sentence          1.334    0.160    8.321    0.000    4.180    0.827
##     wordmean          2.234    0.263    8.482    0.000    7.000    0.841
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.417    2.607    2.845    0.004    0.487    0.487
## 
## Intercepts:
##     visperc          29.315    0.815   35.966    0.000   29.315    4.239
##     cubes            24.699    0.534   46.232    0.000   24.699    5.449
##     lozenges         14.836    0.932   15.912    0.000   14.836    1.875
##     paragrap         10.589    0.420   25.222    0.000   10.589    2.973
##     sentence         19.301    0.596   32.402    0.000   19.301    3.819
##     wordmean         18.014    0.980   18.373    0.000   18.014    2.165
##     Fspatial          0.000                               0.000    0.000
##     Fverbal           0.000                               0.000    0.000
## 
## Variances:
##     visperc          24.204    6.070                     24.204    0.506
##     cubes            11.763    2.620                     11.763    0.572
##     lozenges         28.668    8.002                     28.668    0.458
##     paragrap          2.873    0.881                      2.873    0.226
##     sentence          8.077    1.895                      8.077    0.316
##     wordmean         20.202    5.020                     20.202    0.292
##     Fspatial         23.626    8.237                      1.000    1.000
##     Fverbal           9.817    2.189                      1.000    1.000
## 
## 
## 
## Group 2 [Men]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.035    0.581
##     cubes             0.450    0.176    2.556    0.011    1.817    0.415
##     lozenges          1.510    0.461    3.273    0.001    6.095    0.708
##   Fverbal =~
##     paragrap          1.000                               2.646    0.863
##     sentence          1.275    0.171    7.463    0.000    3.375    0.806
##     wordmean          2.294    0.308    7.451    0.000    6.070    0.805
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           6.937    2.404    2.886    0.004    0.650    0.650
## 
## Intercepts:
##     visperc          29.847    0.825   36.189    0.000   29.847    4.295
##     cubes            24.903    0.520   47.871    0.000   24.903    5.681
##     lozenges         17.111    1.022   16.741    0.000   17.111    1.987
##     paragrap          9.306    0.364   25.578    0.000    9.306    3.035
##     sentence         18.389    0.497   37.032    0.000   18.389    4.395
##     wordmean         16.542    0.895   18.493    0.000   16.542    2.195
##     Fspatial          0.000                               0.000    0.000
##     Fverbal           0.000                               0.000    0.000
## 
## Variances:
##     visperc          32.016    7.080                     32.016    0.663
##     cubes            15.914    2.945                     15.914    0.828
##     lozenges         37.041   11.694                     37.041    0.499
##     paragrap          2.397    0.737                      2.397    0.255
##     sentence          6.120    1.453                      6.120    0.350
##     wordmean         19.974    4.724                     19.974    0.352
##     Fspatial         16.284    7.622                      1.000    1.000
##     Fverbal           7.001    1.645                      1.000    1.000
## 
## R-Square Group Women:
## 
##     visperc           0.494
##     cubes             0.428
##     lozenges          0.542
##     paragrap          0.774
##     sentence          0.684
##     wordmean          0.708
## 
## R-Square Group Men:
## 
##     visperc           0.337
##     cubes             0.172
##     lozenges          0.501
##     paragrap          0.745
##     sentence          0.650
##     wordmean          0.648
```

```r
residuals(fit2, type = "cor")
```

```
## $Women
## $Women$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes     0.023  0.000                            
## lozenges -0.026  0.011  0.000                     
## paragrap  0.042 -0.069  0.010  0.000              
## sentence  0.084 -0.085  0.039 -0.003  0.000       
## wordmean -0.058 -0.084  0.067  0.003  0.000  0.000
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##        0        0        0        0        0        0 
## 
## 
## $Men
## $Men$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes    -0.080  0.000                            
## lozenges -0.003  0.054  0.000                     
## paragrap  0.047  0.037  0.014  0.000              
## sentence -0.050 -0.074 -0.095  0.009  0.000       
## wordmean  0.123 -0.003 -0.006 -0.021  0.017  0.000
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##        0        0        0        0        0        0
```

```r
residuals(fit2, type = "standardized")
```

```
## $Women
## $Women$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc      NA                                   
## cubes     0.809     NA                            
## lozenges     NA  0.517     NA                     
## paragrap  0.654 -1.073  0.183     NA              
## sentence  1.136 -1.199  0.581     NA     NA       
## wordmean -0.921 -1.220  1.003     NA     NA     NA
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##       NA       NA       NA       NA       NA       NA 
## 
## 
## $Men
## $Men$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc      NA                                   
## cubes    -1.263     NA                            
## lozenges -0.150  1.123     NA                     
## paragrap  0.854  0.507  0.344     NA              
## sentence -0.860 -0.980 -2.221     NA     NA       
## wordmean  1.732 -0.038 -0.117     NA  1.012     NA
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##       NA       NA       NA       NA       NA       NA
```



Two latent variables, same factor loadings for groups:


```r
fit4 <- sem(m2, data = d, likelihood = "wishart", group = "sex", group.equal = "loadings")
summary(fit4, standardized = TRUE, fit.measures = TRUE, rsquare = TRUE)
```

```
## lavaan (0.5-15) converged normally after 113 iterations
## 
##   Number of observations per group         
##   Women                                             73
##   Men                                               72
## 
##   Estimator                                         ML
##   Minimum Function Test Statistic               18.291
##   Degrees of freedom                                20
##   P-value (Chi-square)                           0.568
## 
## Chi-square for each group:
## 
##   Women                                          8.554
##   Men                                            9.737
## 
## Model test baseline model:
## 
##   Minimum Function Test Statistic              337.557
##   Degrees of freedom                                30
##   P-value                                        0.000
## 
## User model versus baseline model:
## 
##   Comparative Fit Index (CFI)                    1.000
##   Tucker-Lewis Index (TLI)                       1.008
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -2570.945
##   Loglikelihood unrestricted model (H1)      -2561.672
## 
##   Number of free parameters                         34
##   Akaike (AIC)                                5209.891
##   Bayesian (BIC)                              5310.627
##   Sample-size adjusted Bayesian (BIC)         5203.046
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.000
##   90 Percent Confidence Interval          0.000  0.092
##   P-value RMSEA <= 0.05                          0.749
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.047
## 
## Parameter estimates:
## 
##   Information                                 Expected
##   Standard Errors                             Standard
## 
## Group 1 [Women]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.723    0.684
##     cubes             0.557    0.114    4.890    0.000    2.631    0.596
##     lozenges          1.327    0.248    5.349    0.000    6.266    0.778
##   Fverbal =~
##     paragrap          1.000                               3.140    0.880
##     sentence          1.305    0.117   11.157    0.000    4.098    0.819
##     wordmean          2.260    0.200   11.296    0.000    7.097    0.847
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.325    2.492    2.939    0.003    0.494    0.494
## 
## Intercepts:
##     visperc          29.315    0.814   36.000    0.000   29.315    4.243
##     cubes            24.699    0.520   47.486    0.000   24.699    5.597
##     lozenges         14.836    0.949   15.630    0.000   14.836    1.842
##     paragrap         10.589    0.421   25.179    0.000   10.589    2.968
##     sentence         19.301    0.589   32.742    0.000   19.301    3.859
##     wordmean         18.014    0.987   18.244    0.000   18.014    2.150
##     Fspatial          0.000                               0.000    0.000
##     Fverbal           0.000                               0.000    0.000
## 
## Variances:
##     visperc          25.430    5.913                     25.430    0.533
##     cubes            12.554    2.516                     12.554    0.645
##     lozenges         25.595    8.152                     25.595    0.395
##     paragrap          2.874    0.845                      2.874    0.226
##     sentence          8.228    1.841                      8.228    0.329
##     wordmean         19.821    4.905                     19.821    0.282
##     Fspatial         22.307    7.176                      1.000    1.000
##     Fverbal           9.859    2.053                      1.000    1.000
## 
## 
## 
## Group 2 [Men]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.051    0.582
##     cubes             0.557    0.114    4.890    0.000    2.257    0.498
##     lozenges          1.327    0.248    5.349    0.000    5.375    0.640
##   Fverbal =~
##     paragrap          1.000                               2.639    0.863
##     sentence          1.305    0.117   11.157    0.000    3.444    0.814
##     wordmean          2.260    0.200   11.296    0.000    5.965    0.799
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.095    2.119    3.348    0.001    0.664    0.664
## 
## Intercepts:
##     visperc          29.847    0.826   36.145    0.000   29.847    4.289
##     cubes            24.903    0.538   46.288    0.000   24.903    5.493
##     lozenges         17.111    0.996   17.180    0.000   17.111    2.039
##     paragrap          9.306    0.363   25.627    0.000    9.306    3.041
##     sentence         18.389    0.502   36.623    0.000   18.389    4.346
##     wordmean         16.542    0.887   18.659    0.000   16.542    2.214
##     Fspatial          0.000                               0.000    0.000
##     Fverbal           0.000                               0.000    0.000
## 
## Variances:
##     visperc          32.007    6.775                     32.007    0.661
##     cubes            15.460    2.975                     15.460    0.752
##     lozenges         41.551    9.825                     41.551    0.590
##     paragrap          2.396    0.690                      2.396    0.256
##     sentence          6.038    1.418                      6.038    0.337
##     wordmean         20.218    4.533                     20.218    0.362
##     Fspatial         16.411    5.968                      1.000    1.000
##     Fverbal           6.966    1.486                      1.000    1.000
## 
## R-Square Group Women:
## 
##     visperc           0.467
##     cubes             0.355
##     lozenges          0.605
##     paragrap          0.774
##     sentence          0.671
##     wordmean          0.718
## 
## R-Square Group Men:
## 
##     visperc           0.339
##     cubes             0.248
##     lozenges          0.410
##     paragrap          0.744
##     sentence          0.663
##     wordmean          0.638
```

```r
residuals(fit4, type = "cor")
```

```
## $Women
## $Women$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes     0.075  0.000                            
## lozenges -0.040  0.029  0.000                     
## paragrap  0.046 -0.048 -0.012  0.000              
## sentence  0.090 -0.063  0.021  0.004  0.000       
## wordmean -0.056 -0.066  0.043 -0.002  0.002  0.000
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##        0        0        0        0        0        0 
## 
## 
## $Men
## $Men$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes    -0.129  0.000                            
## lozenges  0.035  0.029  0.000                     
## paragrap  0.040 -0.015  0.044  0.000              
## sentence -0.060 -0.126 -0.070  0.003  0.000       
## wordmean  0.118 -0.050  0.025 -0.015  0.016  0.000
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##        0        0        0        0        0        0
```

```r
residuals(fit4, type = "standardized")
```

```
## $Women
## $Women$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.050                                   
## cubes     1.235  0.782                            
## lozenges     NA  0.633     NA                     
## paragrap  0.641 -0.524 -0.394 -0.101              
## sentence  1.135 -0.626  0.280  0.269  0.333       
## wordmean -0.842 -0.740  0.599 -0.661  0.102 -0.391
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##       NA        0       NA       NA        0       NA 
## 
## 
## $Men
## $Men$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc  -0.051                                   
## cubes    -1.994     NA                            
## lozenges  0.691  0.362  0.753                     
## paragrap  0.521 -0.304  0.738  0.085              
## sentence -0.855 -1.720 -0.919 -0.113 -0.504       
## wordmean  1.353 -0.659  0.454 -0.186  0.304  0.264
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##       NA       NA        0       NA       NA        0
```

```r
anova(fit2, fit4)
```

```
## Chi Square Difference Test
## 
##      Df  AIC  BIC Chisq Chisq diff Df diff Pr(>Chisq)
## fit2 16 5216 5329  16.5                              
## fit4 20 5210 5311  18.3       1.81       4       0.77
```


If you don't use `group.equal`, you can manually constrain the factor loadings to be the same for the groups.


```r
m3 <- '
  Fspatial =~ visperc + c(a, a)*cubes + c(b, b)*lozenges
  Fverbal =~ paragrap + c(c, c)*sentence + c(d, d)*wordmean'
```


Same factor loadings and same factor covariances for both groups.


```r
fit5 <- sem(m2, data = d, likelihood = "wishart", group = "sex", group.equal = c("loadings", 
    "lv.covariances"))
summary(fit5, standardized = TRUE, fit.measures = TRUE, rsquare = TRUE)
```

```
## lavaan (0.5-15) converged normally after 106 iterations
## 
##   Number of observations per group         
##   Women                                             73
##   Men                                               72
## 
##   Estimator                                         ML
##   Minimum Function Test Statistic               18.297
##   Degrees of freedom                                21
##   P-value (Chi-square)                           0.630
## 
## Chi-square for each group:
## 
##   Women                                          8.561
##   Men                                            9.736
## 
## Model test baseline model:
## 
##   Minimum Function Test Statistic              337.557
##   Degrees of freedom                                30
##   P-value                                        0.000
## 
## User model versus baseline model:
## 
##   Comparative Fit Index (CFI)                    1.000
##   Tucker-Lewis Index (TLI)                       1.013
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -2570.948
##   Loglikelihood unrestricted model (H1)      -2561.672
## 
##   Number of free parameters                         33
##   Akaike (AIC)                                5207.897
##   Bayesian (BIC)                              5305.670
##   Sample-size adjusted Bayesian (BIC)         5201.253
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.000
##   90 Percent Confidence Interval          0.000  0.086
##   P-value RMSEA <= 0.05                          0.799
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.047
## 
## Parameter estimates:
## 
##   Information                                 Expected
##   Standard Errors                             Standard
## 
## Group 1 [Women]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.706    0.682
##     cubes             0.557    0.114    4.885    0.000    2.622    0.595
##     lozenges          1.327    0.248    5.342    0.000    6.246    0.777
##   Fverbal =~
##     paragrap          1.000                               3.131    0.879
##     sentence          1.305    0.117   11.154    0.000    4.085    0.818
##     wordmean          2.260    0.200   11.291    0.000    7.077    0.846
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.191    1.731    4.154    0.000    0.488    0.488
## 
## Intercepts:
##     visperc          29.315    0.813   36.056    0.000   29.315    4.249
##     cubes            24.699    0.519   47.549    0.000   24.699    5.604
##     lozenges         14.836    0.947   15.661    0.000   14.836    1.846
##     paragrap         10.589    0.420   25.234    0.000   10.589    2.974
##     sentence         19.301    0.588   32.806    0.000   19.301    3.866
##     wordmean         18.014    0.985   18.281    0.000   18.014    2.155
##     Fspatial          0.000                               0.000    0.000
##     Fverbal           0.000                               0.000    0.000
## 
## Variances:
##     visperc          25.441    5.915                     25.441    0.535
##     cubes            12.552    2.515                     12.552    0.646
##     lozenges         25.589    8.157                     25.589    0.396
##     paragrap          2.874    0.845                      2.874    0.227
##     sentence          8.231    1.841                      8.231    0.330
##     wordmean         19.816    4.905                     19.816    0.283
##     Fspatial         22.149    6.836                      1.000    1.000
##     Fverbal           9.804    1.907                      1.000    1.000
## 
## 
## 
## Group 2 [Men]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.068    0.584
##     cubes             0.557    0.114    4.885    0.000    2.266    0.499
##     lozenges          1.327    0.248    5.342    0.000    5.399    0.642
##   Fverbal =~
##     paragrap          1.000                               2.647    0.863
##     sentence          1.305    0.117   11.154    0.000    3.454    0.815
##     wordmean          2.260    0.200   11.291    0.000    5.984    0.799
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.191    1.731    4.154    0.000    0.668    0.668
## 
## Intercepts:
##     visperc          29.847    0.827   36.097    0.000   29.847    4.284
##     cubes            24.903    0.539   46.234    0.000   24.903    5.487
##     lozenges         17.111    0.998   17.150    0.000   17.111    2.035
##     paragrap          9.306    0.364   25.572    0.000    9.306    3.035
##     sentence         18.389    0.503   36.550    0.000   18.389    4.338
##     wordmean         16.542    0.888   18.624    0.000   16.542    2.210
##     Fspatial          0.000                               0.000    0.000
##     Fverbal           0.000                               0.000    0.000
## 
## Variances:
##     visperc          32.000    6.774                     32.000    0.659
##     cubes            15.465    2.976                     15.465    0.751
##     lozenges         41.536    9.826                     41.536    0.588
##     paragrap          2.395    0.690                      2.395    0.255
##     sentence          6.044    1.418                      6.044    0.336
##     wordmean         20.212    4.533                     20.212    0.361
##     Fspatial         16.548    5.741                      1.000    1.000
##     Fverbal           7.008    1.392                      1.000    1.000
## 
## R-Square Group Women:
## 
##     visperc           0.465
##     cubes             0.354
##     lozenges          0.604
##     paragrap          0.773
##     sentence          0.670
##     wordmean          0.717
## 
## R-Square Group Men:
## 
##     visperc           0.341
##     cubes             0.249
##     lozenges          0.412
##     paragrap          0.745
##     sentence          0.664
##     wordmean          0.639
```

```r
residuals(fit5, type = "cor")
```

```
## $Women
## $Women$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes     0.077  0.000                            
## lozenges -0.039  0.030  0.000                     
## paragrap  0.050 -0.045 -0.008  0.000              
## sentence  0.094 -0.059  0.025  0.005  0.000       
## wordmean -0.052 -0.062  0.048 -0.001  0.003  0.000
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##        0        0        0        0        0        0 
## 
## 
## $Men
## $Men$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes    -0.131  0.000                            
## lozenges  0.033  0.027  0.000                     
## paragrap  0.036 -0.018  0.041  0.000              
## sentence -0.063 -0.128 -0.073  0.002  0.000       
## wordmean  0.115 -0.053  0.021 -0.016  0.015  0.000
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##        0        0        0        0        0        0
```

```r
residuals(fit5, type = "standardized")
```

```
## $Women
## $Women$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.086                                   
## cubes     1.120  0.736                            
## lozenges -0.968  0.537 -0.754                     
## paragrap  0.502 -0.369 -0.134  0.014              
## sentence  0.927 -0.480  0.239  0.211  0.304       
## wordmean -0.536 -0.554  0.415 -0.081  0.121 -0.152
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##       NA        0       NA       NA        0       NA 
## 
## 
## $Men
## $Men$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc  -0.086                                   
## cubes    -1.859     NA                            
## lozenges  0.547  0.292  0.595                     
## paragrap  0.370 -0.300  0.510 -0.007              
## sentence -0.736 -1.514 -0.749 -0.123 -0.396       
## wordmean  1.122 -0.617  0.321 -0.176  0.159  0.171
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##       NA       NA        0       NA       NA        0
```

```r
anova(fit2, fit5)
```

```
## Chi Square Difference Test
## 
##      Df  AIC  BIC Chisq Chisq diff Df diff Pr(>Chisq)
## fit2 16 5216 5329  16.5                              
## fit5 21 5208 5306  18.3       1.82       5       0.87
```



Compare Factor Means Across Groups
-------------------------------------------------------------------------------

Same factor loadings, same intercepts across groups. The intercepts of the latent factors are set to zero in one group.


```r
m7 <- '
  Fspatial =~ visperc + cubes + lozenges
  Fverbal =~ paragrap + sentence +  wordmean
  # intercepts
  Fspatial ~ c(aa, cc)*1
  Fverbal ~ c(bb, dd)*1
  # constraints
  aa == 0
  bb == 0'
fit7 <- sem(m7, data = d, likelihood = "wishart", group = "sex", 
            group.equal = c("intercepts", "loadings"))
summary(fit7, standardized = TRUE, fit.measures = TRUE, rsquare = TRUE)
```

```
## lavaan (0.5-15) converged normally after 567 iterations
## 
##   Number of observations per group         
##   Women                                             73
##   Men                                               72
## 
##   Estimator                                         ML
##   Minimum Function Test Statistic               22.536
##   Degrees of freedom                                24
##   P-value (Chi-square)                           0.547
## 
## Chi-square for each group:
## 
##   Women                                         10.878
##   Men                                           11.658
## 
## Model test baseline model:
## 
##   Minimum Function Test Statistic              337.557
##   Degrees of freedom                                30
##   P-value                                        0.000
## 
## User model versus baseline model:
## 
##   Comparative Fit Index (CFI)                    1.000
##   Tucker-Lewis Index (TLI)                       1.006
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -2573.097
##   Loglikelihood unrestricted model (H1)      -2561.672
## 
##   Number of free parameters                         30
##   Akaike (AIC)                                5206.194
##   Bayesian (BIC)                              5295.080
##   Sample-size adjusted Bayesian (BIC)         5200.155
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.000
##   90 Percent Confidence Interval          0.000  0.089
##   P-value RMSEA <= 0.05                          0.749
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.051
## 
## Parameter estimates:
## 
##   Information                                 Expected
##   Standard Errors                             Standard
## 
## Group 1 [Women]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.637    0.673
##     cubes             0.557    0.114    4.866    0.000    2.582    0.586
##     lozenges          1.371    0.255    5.370    0.000    6.358    0.786
##   Fverbal =~
##     paragrap          1.000                               3.176    0.882
##     sentence          1.279    0.114   11.266    0.000    4.062    0.815
##     wordmean          2.211    0.194   11.389    0.000    7.020    0.842
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.288    2.483    2.935    0.003    0.495    0.495
## 
## Intercepts:
##     Fspatial (aa)     0.000       NA                      0.000    0.000
##     Fverbal  (bb)     0.000       NA                      0.000    0.000
##     visperc          29.079    0.743   39.161    0.000   29.079    4.221
##     cubes            24.525    0.455   53.877    0.000   24.525    5.569
##     lozenges         15.140    0.920   16.459    0.000   15.140    1.872
##     paragrap         10.411    0.411   25.359    0.000   10.411    2.892
##     sentence         19.479    0.546   35.684    0.000   19.479    3.909
##     wordmean         18.328    0.932   19.657    0.000   18.328    2.200
## 
## Variances:
##     visperc          25.965    5.911                     25.965    0.547
##     cubes            12.722    2.524                     12.722    0.656
##     lozenges         25.002    8.305                     25.002    0.382
##     paragrap          2.878    0.865                      2.878    0.222
##     sentence          8.325    1.850                      8.325    0.335
##     wordmean         20.153    4.921                     20.153    0.290
##     Fspatial         21.501    6.972                      1.000    1.000
##     Fverbal          10.085    2.092                      1.000    1.000
## 
## 
## 
## Group 2 [Men]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               3.997    0.575
##     cubes             0.557    0.114    4.866    0.000    2.226    0.492
##     lozenges          1.371    0.255    5.370    0.000    5.481    0.649
##   Fverbal =~
##     paragrap          1.000                               2.669    0.866
##     sentence          1.279    0.114   11.266    0.000    3.414    0.810
##     wordmean          2.211    0.194   11.389    0.000    5.899    0.793
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.079    2.119    3.341    0.001    0.664    0.664
## 
## Intercepts:
##     Fspatial (cc)     1.066    0.887    1.201    0.230    0.267    0.267
##     Fverbal  (dd)    -0.956    0.524   -1.823    0.068   -0.358   -0.358
##     visperc          29.079    0.743   39.161    0.000   29.079    4.185
##     cubes            24.525    0.455   53.877    0.000   24.525    5.420
##     lozenges         15.140    0.920   16.459    0.000   15.140    1.793
##     paragrap         10.411    0.411   25.359    0.000   10.411    3.377
##     sentence         19.479    0.546   35.684    0.000   19.479    4.622
##     wordmean         18.328    0.932   19.657    0.000   18.328    2.462
## 
## Variances:
##     visperc          32.311    6.766                     32.311    0.669
##     cubes            15.521    2.972                     15.521    0.758
##     lozenges         41.293    9.967                     41.293    0.579
##     paragrap          2.382    0.702                      2.382    0.251
##     sentence          6.107    1.422                      6.107    0.344
##     wordmean         20.607    4.567                     20.607    0.372
##     Fspatial         15.976    5.838                      1.000    1.000
##     Fverbal           7.121    1.512                      1.000    1.000
## 
## 
## Constraints:                               Slack (>=0)
##     aa - 0                                       0.000
##     bb - 0                                       0.000
## 
## R-Square Group Women:
## 
##     visperc           0.453
##     cubes             0.344
##     lozenges          0.618
##     paragrap          0.778
##     sentence          0.665
##     wordmean          0.710
## 
## R-Square Group Men:
## 
##     visperc           0.331
##     cubes             0.242
##     lozenges          0.421
##     paragrap          0.749
##     sentence          0.656
##     wordmean          0.628
```

```r
residuals(fit7, type = "cor")
```

```
## $Women
## $Women$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes     0.088  0.000                            
## lozenges -0.037  0.031  0.000                     
## paragrap  0.049 -0.045 -0.017  0.000              
## sentence  0.095 -0.058  0.018  0.005  0.000       
## wordmean -0.051 -0.061  0.041  0.000  0.009  0.000
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##    0.236    0.174   -0.304    0.178   -0.178   -0.315 
## 
## 
## $Men
## $Men$cor
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.000                                   
## cubes    -0.122  0.000                            
## lozenges  0.035  0.028  0.000                     
## paragrap  0.043 -0.013  0.038  0.000              
## sentence -0.055 -0.121 -0.073  0.004  0.000       
## wordmean  0.124 -0.045  0.023 -0.012  0.024  0.000
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##   -0.298   -0.215    0.510   -0.149    0.132    0.326
```

```r
residuals(fit7, type = "standardized")
```

```
## $Women
## $Women$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.173                                   
## cubes     1.357  0.818                            
## lozenges     NA  0.661     NA                     
## paragrap  0.658 -0.504 -0.689 -1.686              
## sentence  1.183 -0.547  0.244  0.225  0.425       
## wordmean -0.696 -0.641  0.569 -0.843  0.374 -0.073
## 
## $Women$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##    0.732    0.639   -2.876    2.449   -0.781   -1.122 
## 
## 
## $Men
## $Men$cov
##          visprc cubes  lozngs pargrp sentnc wordmn
## visperc   0.005                                   
## cubes    -1.807     NA                            
## lozenges  0.668  0.340  0.621                     
## paragrap  0.530 -0.295  0.621 -0.324              
## sentence -0.739 -1.605 -0.986 -0.176 -0.285       
## wordmean  1.405 -0.570  0.422 -0.185  0.510  0.348
## 
## $Men$mean
##  visperc    cubes lozenges paragrap sentence wordmean 
##   -0.738   -0.793    1.136   -2.157    0.961    0.979
```


Verbose syntax:


```r
m6 <- "\n  Fspatial =~ visperc + c(a, a)*cubes + c(b, b)*lozenges\n  Fverbal =~ paragrap + c(c, c)*sentence + c(d, d)*wordmean\n  \n  Fspatial ~ c(aa, cc)*1\n  Fverbal ~ c(bb, dd)*1\n  visperc ~ c(ee, ee)*1\n  cubes ~ c(ff, ff)*1\n  lozenges ~ c(gg, gg)*1\n  paragrap ~ c(hh, hh)*1\n  sentence ~ c(ii, ii)*1\n  wordmean ~ c(jj, jj)*1\n\n  aa == 0\n  bb == 0"
```





MIMIC Model
-------------------------------------------------------------------------------

This model assumes several levels of measurement invariance between the groups.


```r
m8 <- '
  Fspatial =~ visperc + cubes + lozenges
  Fverbal =~ paragrap + sentence + wordmean

  Fspatial ~ sex
  Fverbal ~ sex

  Fspatial ~~ Fverbal'

fit8 <- sem(m8, data = d, likelihood = "wishart")
summary(fit7, standardized = TRUE, fit.measures = TRUE, rsquare = TRUE)
```

```
## lavaan (0.5-15) converged normally after 567 iterations
## 
##   Number of observations per group         
##   Women                                             73
##   Men                                               72
## 
##   Estimator                                         ML
##   Minimum Function Test Statistic               22.536
##   Degrees of freedom                                24
##   P-value (Chi-square)                           0.547
## 
## Chi-square for each group:
## 
##   Women                                         10.878
##   Men                                           11.658
## 
## Model test baseline model:
## 
##   Minimum Function Test Statistic              337.557
##   Degrees of freedom                                30
##   P-value                                        0.000
## 
## User model versus baseline model:
## 
##   Comparative Fit Index (CFI)                    1.000
##   Tucker-Lewis Index (TLI)                       1.006
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -2573.097
##   Loglikelihood unrestricted model (H1)      -2561.672
## 
##   Number of free parameters                         30
##   Akaike (AIC)                                5206.194
##   Bayesian (BIC)                              5295.080
##   Sample-size adjusted Bayesian (BIC)         5200.155
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          0.000
##   90 Percent Confidence Interval          0.000  0.089
##   P-value RMSEA <= 0.05                          0.749
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.051
## 
## Parameter estimates:
## 
##   Information                                 Expected
##   Standard Errors                             Standard
## 
## Group 1 [Women]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               4.637    0.673
##     cubes             0.557    0.114    4.866    0.000    2.582    0.586
##     lozenges          1.371    0.255    5.370    0.000    6.358    0.786
##   Fverbal =~
##     paragrap          1.000                               3.176    0.882
##     sentence          1.279    0.114   11.266    0.000    4.062    0.815
##     wordmean          2.211    0.194   11.389    0.000    7.020    0.842
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.288    2.483    2.935    0.003    0.495    0.495
## 
## Intercepts:
##     Fspatial (aa)     0.000       NA                      0.000    0.000
##     Fverbal  (bb)     0.000       NA                      0.000    0.000
##     visperc          29.079    0.743   39.161    0.000   29.079    4.221
##     cubes            24.525    0.455   53.877    0.000   24.525    5.569
##     lozenges         15.140    0.920   16.459    0.000   15.140    1.872
##     paragrap         10.411    0.411   25.359    0.000   10.411    2.892
##     sentence         19.479    0.546   35.684    0.000   19.479    3.909
##     wordmean         18.328    0.932   19.657    0.000   18.328    2.200
## 
## Variances:
##     visperc          25.965    5.911                     25.965    0.547
##     cubes            12.722    2.524                     12.722    0.656
##     lozenges         25.002    8.305                     25.002    0.382
##     paragrap          2.878    0.865                      2.878    0.222
##     sentence          8.325    1.850                      8.325    0.335
##     wordmean         20.153    4.921                     20.153    0.290
##     Fspatial         21.501    6.972                      1.000    1.000
##     Fverbal          10.085    2.092                      1.000    1.000
## 
## 
## 
## Group 2 [Men]:
## 
##                    Estimate  Std.err  Z-value  P(>|z|)   Std.lv  Std.all
## Latent variables:
##   Fspatial =~
##     visperc           1.000                               3.997    0.575
##     cubes             0.557    0.114    4.866    0.000    2.226    0.492
##     lozenges          1.371    0.255    5.370    0.000    5.481    0.649
##   Fverbal =~
##     paragrap          1.000                               2.669    0.866
##     sentence          1.279    0.114   11.266    0.000    3.414    0.810
##     wordmean          2.211    0.194   11.389    0.000    5.899    0.793
## 
## Covariances:
##   Fspatial ~~
##     Fverbal           7.079    2.119    3.341    0.001    0.664    0.664
## 
## Intercepts:
##     Fspatial (cc)     1.066    0.887    1.201    0.230    0.267    0.267
##     Fverbal  (dd)    -0.956    0.524   -1.823    0.068   -0.358   -0.358
##     visperc          29.079    0.743   39.161    0.000   29.079    4.185
##     cubes            24.525    0.455   53.877    0.000   24.525    5.420
##     lozenges         15.140    0.920   16.459    0.000   15.140    1.793
##     paragrap         10.411    0.411   25.359    0.000   10.411    3.377
##     sentence         19.479    0.546   35.684    0.000   19.479    4.622
##     wordmean         18.328    0.932   19.657    0.000   18.328    2.462
## 
## Variances:
##     visperc          32.311    6.766                     32.311    0.669
##     cubes            15.521    2.972                     15.521    0.758
##     lozenges         41.293    9.967                     41.293    0.579
##     paragrap          2.382    0.702                      2.382    0.251
##     sentence          6.107    1.422                      6.107    0.344
##     wordmean         20.607    4.567                     20.607    0.372
##     Fspatial         15.976    5.838                      1.000    1.000
##     Fverbal           7.121    1.512                      1.000    1.000
## 
## 
## Constraints:                               Slack (>=0)
##     aa - 0                                       0.000
##     bb - 0                                       0.000
## 
## R-Square Group Women:
## 
##     visperc           0.453
##     cubes             0.344
##     lozenges          0.618
##     paragrap          0.778
##     sentence          0.665
##     wordmean          0.710
## 
## R-Square Group Men:
## 
##     visperc           0.331
##     cubes             0.242
##     lozenges          0.421
##     paragrap          0.749
##     sentence          0.656
##     wordmean          0.628
```

```r
residuals(fit8, type = "cor")
```

```
## $cor
##          visprc cubes  lozngs pargrp sentnc wordmn sex   
## visperc   0.000                                          
## cubes     0.002  0.000                                   
## lozenges -0.017  0.023  0.000                            
## paragrap  0.055 -0.014 -0.020  0.000                     
## sentence  0.041 -0.067 -0.039  0.001  0.000              
## wordmean  0.048 -0.033  0.020 -0.007  0.009  0.000       
## sex      -0.040 -0.044  0.041 -0.050  0.034  0.040  0.000
## 
## $mean
##  visperc    cubes lozenges paragrap sentence wordmean      sex 
##        0        0        0        0        0        0        0
```

```r
residuals(fit8, type = "standardized")
```

```
## $cov
##          visprc cubes  lozngs pargrp sentnc wordmn sex   
## visperc      NA                                          
## cubes     0.043     NA                                   
## lozenges -2.550  0.986     NA                            
## paragrap  1.154 -0.265 -0.621     NA                     
## sentence  0.785 -1.206 -1.011     NA     NA              
## wordmean  0.917 -0.590  0.477     NA  0.937     NA       
## sex      -0.741 -0.688  1.161 -1.625  0.873  1.051  0.000
## 
## $mean
##  visperc    cubes lozenges paragrap sentence wordmean      sex 
##        0        0        0        0        0        0        0
```


***
  

```r
sessionInfo()
```

```
## R version 3.0.2 (2013-09-25)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## 
## locale:
## [1] LC_COLLATE=English_United States.1252 
## [2] LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252
## [4] LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] foreign_0.8-55 lavaan_0.5-15  knitr_1.5     
## 
## loaded via a namespace (and not attached):
## [1] evaluate_0.5.1 formatR_0.10   MASS_7.3-29    mnormt_1.4-7  
## [5] pbivnorm_0.5-1 quadprog_1.5-5 stats4_3.0.2   stringr_0.6.2 
## [9] tools_3.0.2
```

